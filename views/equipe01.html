<!doctype html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard - Apresentação Equipa 1</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
        crossorigin="anonymous"></script>

    <style>
        @font-face {
            font-family: 'Digital Dismay';
            src: url('../resources/fonts/digital_dismay.otf') format('truetype');
        }

        @font-face {
            font-family: 'Gobold';
            src: url('../resources/fonts/gobold_bold.otf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
            font-family: Gobold, Arial, sans-serif;
        }

        .main-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }

        /* Linha horizontal - centro exato */
        .horizontal-line {
            position: fixed;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #555;
            z-index: 100;
        }

        /* Linha vertical - centro exato */
        .vertical-line {
            position: fixed;
            left: 50%;
            top: 0;
            height: 100%;
            width: 2px;
            background-color: #555;
            z-index: 100;
        }

        /* Logo e nome da equipa - canto superior esquerdo */
        .team-info {
            position: fixed;
            top: 0;
            left: 0;
            width: 25%;
            height: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .team-logo {
            max-width: 60%;
            max-height: 50%;
            object-fit: contain;
        }

        .team-name {
            font-size: 2.5vw;
            font-weight: bold;
            color: white;
            margin-top: 15px;
            text-align: center;
        }

        /* Números dos jogadores - entre logo e linha vertical (superior) */
        .numbers-group-1 {
            position: fixed;
            top: 0;
            left: 25%;
            width: 25%;
            height: 50%;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            padding: 20px;
            padding-right: 30px;
        }

        /* Números dos jogadores - entre logo e linha vertical (inferior) */
        .numbers-group-2 {
            position: fixed;
            top: 50%;
            left: 25%;
            width: 25%;
            height: 50%;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            padding: 20px;
            padding-right: 30px;
        }

        /* Nomes dos jogadores - à direita da linha vertical (superior) */
        .names-group-1 {
            position: fixed;
            top: 0;
            left: 50%;
            right: 0;
            height: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            padding-left: 30px;
        }

        /* Nomes dos jogadores - à direita da linha vertical (inferior) */
        .names-group-2 {
            position: fixed;
            top: 50%;
            left: 50%;
            right: 0;
            height: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            padding-left: 30px;
        }

        .player-number {
            font-family: 'Digital Dismay', sans-serif;
            font-size: 4.5vw;
            line-height: 1.5;
            color: #FFD700;
            text-align: right;
        }

        .player-name {
            font-size: 3.5vw;
            line-height: 1.5;
            color: white;
            font-family: Gobold, Arial, sans-serif;
        }
    </style>
</head>

<body>
    <div class="main-wrapper">
        <!-- Linhas da cruz -->
        <div class="horizontal-line"></div>
        <div class="vertical-line"></div>

        <!-- Logo e nome da equipa -->
        <div class="team-info">
            <img id="img-cfg-equipes-logo" class="team-logo" alt="Logo" src="" />
            <div id="nome-equipe" class="team-name">EQUIPA</div>
        </div>

        <!-- Números grupo 1 (à esquerda da linha vertical, em cima) -->
        <div class="numbers-group-1" id="numbers-1"></div>

        <!-- Nomes grupo 1 (à direita da linha vertical, em cima) -->
        <div class="names-group-1" id="names-1"></div>

        <!-- Números grupo 2 (à esquerda da linha vertical, em baixo) -->
        <div class="numbers-group-2" id="numbers-2"></div>

        <!-- Nomes grupo 2 (à direita da linha vertical, em baixo) -->
        <div class="names-group-2" id="names-2"></div>
    </div>

    <script>
        window.$ = window.jQuery = require('jquery');
        const { ipcRenderer } = require('electron');
        const sqlite3 = require('sqlite3').verbose();

        var configEquipaTime = null;
        var configEquipaJogadores = [];

        function getConfigEquipaTime(id) {
            var db = new sqlite3.Database('./scoreboard.sqlite');
            db.all("SELECT * FROM config_equipas_times where id =" + id, function (err, rows) {
                if (err) {
                    console.error('Erro ao carregar equipa:', err.message);
                    db.close();
                    return;
                }
                configEquipaTime = rows;
                loadConfigEquipaTime();
                db.close();
            });
        }

        function loadConfigEquipaTime() {
            if (configEquipaTime && configEquipaTime[0]) {
                var nome = configEquipaTime[0]["abreviatura"] || configEquipaTime[0]["nome"] || "EQUIPA";
                document.getElementById("nome-equipe").textContent = nome;
                var logo = configEquipaTime[0]["logo_caminho"];
                if (logo) {
                    document.getElementById("img-cfg-equipes-logo").src = logo;
                }
            }
        }

        function getConfigEquipaTimeJogadores(timeId) {
            var db = new sqlite3.Database('./scoreboard.sqlite');
            db.all("SELECT * FROM config_equipas_times_jogadores where time_id =" + timeId + " order by id asc", function (err, rows) {
                if (err) {
                    console.error('Erro ao carregar jogadores:', err.message);
                    db.close();
                    return;
                }
                configEquipaJogadores = rows || [];
                loadConfigEquipaTimeJogadores();
                db.close();
            });
        }

        function loadConfigEquipaTimeJogadores() {
            var numbers1 = document.getElementById('numbers-1');
            var names1 = document.getElementById('names-1');
            var numbers2 = document.getElementById('numbers-2');
            var names2 = document.getElementById('names-2');

            numbers1.innerHTML = '';
            names1.innerHTML = '';
            numbers2.innerHTML = '';
            names2.innerHTML = '';

            var jogadores = [];
            for (var i = 0; i < configEquipaJogadores.length; i++) {
                var j = configEquipaJogadores[i];
                var pos = (j.posicao || '').toString().toUpperCase().trim();
                if (pos !== 'TREINADOR' && pos !== 'TÉCNICO' && pos !== 'TECNICO') {
                    jogadores.push(j);
                }
            }

            var total = jogadores.length;

            if (total === 0) {
                return;
            }

            // Máximo 7 jogadores: 4 em cima, 3 em baixo
            if (total > 7) {
                jogadores = jogadores.slice(0, 7);
                total = 7;
            }

            // Primeiros 4 vão para cima, resto vai para baixo
            var group1Players = jogadores.slice(0, Math.min(4, total));
            var group2Players = total > 4 ? jogadores.slice(4) : [];

            // Grupo 1 (em cima)
            for (var i = 0; i < group1Players.length; i++) {
                numbers1.appendChild(createNumberElement(group1Players[i]));
                names1.appendChild(createNameElement(group1Players[i]));
            }

            // Grupo 2 (em baixo)
            for (var i = 0; i < group2Players.length; i++) {
                numbers2.appendChild(createNumberElement(group2Players[i]));
                names2.appendChild(createNameElement(group2Players[i]));
            }
        }

        function createNumberElement(jogador) {
            var div = document.createElement('div');
            div.className = 'player-number';
            var camisa = jogador.camisa ? jogador.camisa.toString() : '00';
            div.textContent = camisa.padStart(2, '0');
            return div;
        }

        function createNameElement(jogador) {
            var div = document.createElement('div');
            div.className = 'player-name';

            var nomeCompleto = jogador.nome || '';
            // Mostrar nome completo, capitalizado
            var nomeFormatado = nomeCompleto.toLowerCase().replace(/\b\w/g, function (l) { return l.toUpperCase(); });

            div.textContent = nomeFormatado;
            return div;
        }

        ipcRenderer.on('reloadAll', function (event, args) {
            getConfigEquipaTime("1");
            getConfigEquipaTimeJogadores("1");
        });

        window.onload = function () {
            getConfigEquipaTime("1");
            getConfigEquipaTimeJogadores("1");
        };
    </script>
</body>

</html>